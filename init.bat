:: Init Script for cmd.exe
:: Sets some nice defaults
:: Created as part of PentestBox project

:: Find root dir
@if not defined pentestbox_ROOT (
    for /f %%i in ("%ConEmuDir%\..\..") do @set pentestbox_ROOT=%%~fi
)

:: Change the prompt style
@prompt $E[1;32;40mCMD $P$S{git}$S$_$E[1;30;40m{lamb}$S$E[0m

:: Pick right version of clink
@if "%PROCESSOR_ARCHITECTURE%"=="x86" (
    set architecture=86
) else (
    set architecture=64
)

:: Run clink
@"%pentestbox_ROOT%\base\clink\clink_x%architecture%.exe" inject --quiet --profile "%pentestbox_ROOT%\config"

:: Prepare for msysgit

:: I do not even know, copypasted from their .bat
@set PLINK_PROTOCOL=ssh
@if not defined TERM set TERM=cygwin

:: Enhance Path
@set git_install_root=%pentestbox_ROOT%\base\PortableGit
@call :AddPATH %pentestbox_ROOT%\bin
@call :AddPATH %git_install_root%\bin
@call :AddPATH %git_install_root%\mingw32\bin
@call :AddPATH %git_install_root%\usr\bin
@call :AddPATH %git_install_root%\cmd
@call :AddPATH %git_install_root%\share\vim\vim74
@call :AddPATH %pentestbox_ROOT%\base\curl\bin
@call :AddPATH %pentestbox_ROOT%\base\ruby\bin
@call :AddPATH %pentestbox_ROOT%\base\ruby_devkit\bin
@call :AddPATH %pentestbox_ROOT%\base\ruby_devkit\mingw\bin
@call :AddPATH %pentestbox_ROOT%\base\strawberry-perl\perl\bin
@call :AddPATH %pentestbox_ROOT%\base\strawberry-perl\c\bin
@call :AddPATH %pentestbox_ROOT%\base\strawberry-perl\
@call :AddPATH %pentestbox_ROOT%\bin\nmap
@call :AddPATH %pentestbox_ROOT%\base\jdk1.8.0_74\bin
@call :AddPATH %pentestbox_ROOT%\base\jdk1.8.0_74\jre\bin
@call :AddPATH %pentestbox_ROOT%\base\jdk1.8.0_74\jre\lib
@call :AddPATH %pentestbox_ROOT%\bin\aircrack-ng-1.2-rc4-win\bin\32bit
@call :AddPATH %pentestbox_ROOT%\bin\password_attacks\rainbowcrack
@call :AddPATH %pentestbox_ROOT%\bin\androidsecurity\dex2jar
@call :AddPATH %pentestbox_ROOT%\bin\androidsecurity\sdk\platform-tools
@call :AddPATH %pentestbox_ROOT%\bin\7za
@call :AddPATH %pentestbox_ROOT%\bin\wget
@call :AddPATH %SystemRoot%\system32
@call :AddPATH %pentestbox_ROOT%\base\python
@call :AddPATH %pentestbox_ROOT%\base\python3
@call :AddPATH %pentestbox_ROOT%\base\python3\Scripts
@call :AddPATH %pentestbox_ROOT%\bin\gow\bin
@call :AddPATH %pentestbox_ROOT%\bin\SysinternalsSuite
@call :AddPATH %pentestbox_ROOT%\bin\LogParser
@set CURL_CA_BUNDLE=%pentestbox_ROOT%\base\curl\bin\ca-bundle.crt
@set SSL_CERT_FILE=%pentestbox_ROOT%\base\curl\bin\cacert.pem
:: Add aliases
@doskey /macrofile="%pentestbox_ROOT%\config\aliases"
:: Custom aliases
@if exist "%pentestbox_ROOT%\bin\customtools\customaliases" (
	@doskey /macrofile="%pentestbox_ROOT%\bin\customtools\customaliases"
)
:: Set home path
@if not defined HOME set HOME=%USERPROFILE%

@if defined pentestbox_START (
    @cd /d "%pentestbox_START%"
) else (
    @if "%CD%\" == "%pentestbox_ROOT%" (
        @cd /d "%HOME%"
    )
)
@exit/b

:: Add directory to %PATH%
:: Usage: call :AddPATH <dir>
:AddPATH
@echo %PATH% | C:\Windows\System32\find.exe /i "%~1" >nul && exit/b
@pushd "%~1" 2>nul && popd && PATH=%~1;%PATH%
@goto :EOF
